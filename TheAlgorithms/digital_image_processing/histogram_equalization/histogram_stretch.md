# 히스토그램 스트레칭 (Histogram Stretching) / 평활화 (Equalization)

이 문서는 `histogram_stretch.py` 파일에 구현된 이미지 처리 알고리즘에 대해 설명합니다. 클래스 이름과 파일명은 'Contrast Stretch(대비 스트레칭)'를 의미하지만, 내부 로직은 누적 분포 함수(CDF)를 사용하는 **히스토그램 평활화(Histogram Equalization)** 알고리즘을 구현하고 있습니다.

## 개요

히스토그램 평활화는 이미지의 픽셀 밝기 분포(히스토그램)를 균일하게 만들어 명암 대비(Contrast)를 높이는 기법입니다. 어둡거나 밝은 영역에 뭉쳐있는 픽셀 값들을 전체 범위(0~255)로 골고루 퍼뜨려 이미지를 선명하게 만듭니다.

## 클래스: `contrastStretch`

### `__init__(self)`
- 클래스 변수들을 초기화합니다.
- `self.L = 256`: 픽셀이 가질 수 있는 밝기 단계의 수 (8비트 이미지 기준).

### `stretch(self, input_image)`
- **목적**: 입력 이미지에 히스토그램 평활화를 적용합니다.
- **알고리즘 단계**:
  1. **이미지 로드**: `cv2.imread`를 사용하여 이미지를 그레이스케일 모드(0)로 읽어옵니다.
  2. **히스토그램 계산**: `plt.hist`를 사용하여 각 밝기 값(0~255)의 빈도수를 구합니다.
  3. **매핑 테이블 생성**:
     - 각 밝기 값의 발생 확률(`prk`)을 계산합니다.
     - 누적 확률(`sk`)을 계산합니다 (CDF - Cumulative Distribution Function).
     - 누적 확률에 `L-1`(255)을 곱하여 새로운 픽셀 값을 계산합니다.
     - 계산된 값을 반올림하여 정수형으로 변환하고 `last_list`에 저장합니다. 이 리스트는 원본 픽셀 값을 새로운 값으로 변환하는 매핑 테이블 역할을 합니다.
  4. **이미지 변환**:
     - 이중 반복문을 통해 이미지의 모든 픽셀(`self.img[j][i]`)을 순회합니다.
     - 각 픽셀의 값을 `last_list`에 매핑된 새로운 값으로 교체합니다.
  5. **저장**: 변환된 이미지를 `output_data/output.jpg`로 저장합니다.

### `plotHistogram(self)`
- 변환된 결과 이미지의 히스토그램을 그래프로 표시합니다.

### `showImage(self)`
- 원본 이미지(`Input-Image`)와 결과 이미지(`Output-Image`)를 OpenCV 윈도우로 화면에 띄웁니다.
- 5초간 대기 후 창을 닫습니다.

## 사용법

`if __name__ == "__main__":` 블록에서 사용 예시를 확인할 수 있습니다:

1. 이미지 파일 경로를 설정합니다.
2. `contrastStretch` 인스턴스를 생성합니다.
3. `stretch()` 메서드를 호출하여 이미지를 변환합니다.
4. 히스토그램을 출력하고 이미지를 보여줍니다.

## 참고 사항

- **구현 방식**: 이 코드는 NumPy의 벡터화 연산을 사용하지 않고 이중 `for` 루프를 사용하여 픽셀 값을 직접 수정하므로, 해상도가 높은 이미지의 경우 처리 속도가 느릴 수 있습니다.
- **코드 로직**:
  - `self.rem = int(last % last)` 부분은 `last`가 0이 아닐 때 항상 0이 되므로, 의도한 반올림 로직이 맞는지 확인이 필요합니다.
  - 파일 경로 설정 시 `os.path.basename(__file__)`을 사용하고 있는데, 이는 파일명을 반환하므로 디렉토리 경로를 얻기 위해서는 `os.path.dirname(__file__)`을 사용하는 것이 일반적입니다.