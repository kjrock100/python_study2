# 이미지 컨볼루션 (Image Convolution)

이 문서는 `convolve.py` 파일에 구현된 **이미지 컨볼루션(Image Convolution)** 알고리즘에 대해 설명합니다. 이 코드는 일반적인 반복문 기반의 컨볼루션 대신, `im2col` (image to column) 기법을 사용하여 컨볼루션 연산을 고속 행렬 곱셈으로 변환하여 처리합니다.

## 개요

컨볼루션(합성곱)은 이미지 처리에서 필터링, 엣지 검출, 블러링 등에 필수적으로 사용되는 연산입니다. 이 코드는 입력 이미지의 각 패치(patch)를 행렬의 행으로 변환한 뒤, 필터(커널)와 행렬 곱셈을 수행하여 연산 효율을 높이는 방식을 보여줍니다.

## 주요 함수 설명

### `im2col(image, block_size)`
- **목적**: 이미지를 슬라이딩 윈도우 방식으로 순회하며, 커널(필터) 크기에 해당하는 각 영역을 1차원 배열로 펼쳐서 큰 행렬(`image_array`)의 행으로 만듭니다.
- **매개변수**:
  - `image`: 입력 이미지 (2D 배열).
  - `block_size`: 커널의 크기 (행, 열).
- **동작**:
  - 이미지의 `(i, j)` 위치에서 `block_size`만큼의 영역을 잘라내어(`window`), 이를 1차원으로 평탄화(`ravel`)합니다.
  - 평탄화된 벡터를 결과 행렬의 한 행으로 저장합니다.

### `img_convolve(image, filter_kernel)`
- **목적**: 입력 이미지에 필터 커널을 적용하여 컨볼루션 연산을 수행합니다.
- **매개변수**:
  - `image`: 입력 이미지.
  - `filter_kernel`: 적용할 컨볼루션 커널 (예: 라플라시안, 가우시안 등).
- **알고리즘 단계**:
  1. **패딩(Padding)**: 커널 크기에 맞춰 이미지 가장자리에 값을 채워 넣습니다(`pad` 함수, `mode="edge"`). 이는 컨볼루션 후 이미지 크기가 줄어드는 것을 방지합니다.
  2. **im2col 변환**: 패딩된 이미지를 `im2col` 함수를 통해 행렬 형태로 변환합니다.
  3. **커널 평탄화**: 2차원 커널을 1차원 벡터로 변환합니다.
  4. **행렬 곱셈**: 변환된 이미지 행렬과 커널 벡터를 내적(`dot`)합니다. 이 한 번의 연산으로 모든 픽셀 위치에서의 컨볼루션 값이 계산됩니다.
  5. **형상 복원**: 1차원 결과 배열을 원래 이미지의 높이와 너비(`height`, `width`)에 맞게 2차원으로 재구성(`reshape`)합니다.

## 사용법

`if __name__ == "__main__":` 블록에서 사용 예시를 확인할 수 있습니다:

1. `image_data/lena.jpg` 이미지를 불러옵니다.
2. `cvtColor`를 사용하여 그레이스케일로 변환합니다.
3. **라플라시안(Laplacian) 커널**을 정의합니다. (엣지 검출에 사용됨)
   ```python
   [[0, 1, 0],
    [1, -4, 1],
    [0, 1, 0]]
   ```
4. `img_convolve` 함수를 호출하여 필터링을 수행합니다.
5. 결과 이미지를 화면에 표시합니다.