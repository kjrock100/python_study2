# 게일-섀플리 알고리즘 (Gale-Shapley Algorithm)

이 문서는 `gale_shapley_bigraph.py` 파일에 구현된 **게일-섀플리 알고리즘**에 대해 설명합니다. 이 알고리즘은 이분 그래프(Bipartite Graph)에서 **안정된 매칭(Stable Matching)**을 찾는 데 사용됩니다.

## 개요

안정된 매칭이란, 매칭된 짝들 사이에서 서로를 현재 파트너보다 더 선호하는 두 사람이 존재하지 않는 상태를 말합니다. 이 코드는 장기 기증자(Donor)와 수혜자(Recipient) 간의 매칭 문제를 예시로 구현되었습니다.

## 주요 함수: `stable_matching`

### `stable_matching(donor_pref, recipient_pref)`

- **목적**: 기증자와 수혜자의 선호도 리스트를 입력받아 안정된 매칭 결과를 반환합니다.
- **매개변수**:
  - `donor_pref`: 각 기증자가 선호하는 수혜자의 순위 리스트 (2차원 리스트).
  - `recipient_pref`: 각 수혜자가 선호하는 기증자의 순위 리스트 (2차원 리스트).
- **반환값**: 매칭 결과를 담은 리스트. 리스트의 인덱스는 기증자 번호, 값은 매칭된 수혜자 번호를 의미합니다.

### 알고리즘 동작 원리

1. **초기화**:
   - 모든 기증자를 '매칭되지 않음(unmatched)' 상태로 시작합니다.
   - `donor_record`: 기증자가 누구에게 기증했는지 기록.
   - `rec_record`: 수혜자가 누구로부터 기증받았는지 기록.
   - `num_donations`: 각 기증자가 몇 번째 선호도까지 제안했는지 추적.

2. **매칭 루프 (While Unmatched Donors)**:
   - 매칭되지 않은 기증자가 있는 동안 반복합니다.
   - 매칭되지 않은 기증자(`donor`)를 하나 선택합니다.
   - 해당 기증자는 자신의 선호도 리스트에서 아직 제안하지 않은 가장 높은 순위의 수혜자(`recipient`)에게 제안합니다.
   - **수혜자가 매칭되지 않은 상태라면**:
     - 즉시 매칭을 성사시킵니다.
   - **수혜자가 이미 다른 기증자(`prev_donor`)와 매칭된 상태라면**:
     - 수혜자의 선호도 리스트를 확인합니다.
     - 만약 수혜자가 현재 파트너(`prev_donor`)보다 새로운 제안자(`donor`)를 더 선호한다면:
       - 기존 매칭을 깨고(`prev_donor`는 다시 매칭되지 않은 상태가 됨), 새로운 기증자와 매칭합니다.
     - 그렇지 않다면:
       - 제안은 거절되고, 기증자는 다음 순위의 수혜자에게 제안하기 위해 대기합니다.

3. **종료**: 모든 기증자가 매칭되거나 더 이상 제안할 수 없을 때 종료하며, 최종 매칭 결과를 반환합니다.

## 사용법

독스트링(Docstring)에 포함된 예제를 통해 동작을 확인할 수 있습니다.

```python
donor_pref = [
    [0, 1, 3, 2], [0, 2, 3, 1], [1, 0, 2, 3], [0, 3, 1, 2]
]
recipient_pref = [
    [3, 1, 2, 0], [3, 1, 0, 2], [0, 3, 1, 2], [1, 0, 3, 2]
]
print(stable_matching(donor_pref, recipient_pref))
# 결과: [1, 2, 3, 0]
# (기증자 0 -> 수혜자 1, 기증자 1 -> 수혜자 2, ...)
```
