# `segment_tree.py` 코드 설명

이 문서는 `segment_tree.py` 스크립트에 구현된 세그먼트 트리에 대해 설명합니다.

## 1. 세그먼트 트리란?

세그먼트 트리는 배열의 특정 구간에 대한 연산(예: 합, 곱, 최댓값, 최솟값)을 효율적으로 수행하는 자료 구조입니다. 이 구현은 재귀(Recursion)를 사용하여 트리를 구축하고, 쿼리 및 업데이트를 수행합니다.

**주요 특징:**
-   **구현 방식**: 내부적으로 하나의 리스트(`st`)를 사용하여 트리를 표현합니다.
-   **지원 연산**: 이 구현은 **구간 최댓값(Range Maximum)**을 구하는 데 특화되어 있습니다.
-   **인덱싱**: 사용자가 호출하는 `query` 및 `update` 메서드는 **1-기반 인덱싱(1-based indexing)**을 사용합니다.

## 2. 클래스 및 메서드 설명

### `SegmentTree` 클래스

#### `__init__(self, A)`
-   **역할**: 입력 배열 `A`를 기반으로 세그먼트 트리를 초기화하고 구축합니다.
-   **매개변수**:
    -   `A`: 원본 데이터 리스트.
-   **동작**:
    1.  원본 배열 크기(`N`)의 약 4배 크기로 세그먼트 트리 리스트(`st`)를 초기화합니다.
    2.  `build()` 메서드를 호출하여 트리를 구축합니다.
    > **주의**: 현재 구현에서 `build` 메서드는 생성자로부터 `A`를 직접 전달받지 않고, 스크립트의 전역 변수 `A`에 의존하는 문제가 있습니다.

#### `build(self, idx, l, r)`
-   **역할**: 재귀적으로 세그먼트 트리를 구축합니다.
-   **시간 복잡도**: O(N)
-   **동작**: 주어진 구간 `[l, r]`을 반으로 나누어 왼쪽과 오른쪽 자식 트리를 재귀적으로 만든 후, 두 자식의 최댓값을 현재 노드의 값으로 설정합니다.

#### `update(self, a, b, val)`
-   **역할**: 구간 `[a, b]`의 모든 원소 값을 `val`로 업데이트합니다. 공개용 인터페이스이며, 내부적으로 `update_recursive`를 호출합니다.
-   **시간 복잡도**: O(N). 이 메서드는 구간 내 모든 리프 노드를 방문하므로 효율적이지 않습니다. 일반적인 세그먼트 트리의 포인트 업데이트(O(log N))와는 다릅니다.

#### `query(self, a, b)`
-   **역할**: 구간 `[a, b]`의 최댓값을 반환합니다. 공개용 인터페이스이며, 내부적으로 `query_recursive`를 호출합니다.
-   **시간 복잡도**: O(log N)

#### `showData(self)`
-   **역할**: 현재 트리가 나타내는 배열의 상태를 출력합니다.
-   **동작**: 각 인덱스 `i`에 대해 `query(i, i)`를 호출하여 값을 얻고 리스트로 만들어 출력합니다.

### 내부 헬퍼 메서드

#### `update_recursive(self, idx, l, r, a, b, val)`
-   **역할**: 재귀적으로 `[a, b]` 구간에 포함되는 리프 노드들을 찾아 값을 갱신하고, 상위 노드들의 값을 다시 계산합니다.

#### `query_recursive(self, idx, l, r, a, b)`
-   **역할**: 재귀적으로 `[a, b]` 구간의 최댓값을 찾습니다.
-   **동작**:
    1.  **겹치지 않음**: 현재 노드의 구간이 쿼리 구간과 전혀 겹치지 않으면, 최댓값 계산에 영향을 주지 않는 매우 작은 값(`-math.inf`)을 반환합니다.
    2.  **완전 포함**: 현재 노드의 구간이 쿼리 구간에 완전히 포함되면, 현재 노드의 값을 반환합니다.
    3.  **부분 포함**: 쿼리 구간이 양쪽 자식에 걸쳐 있으면, 양쪽으로 각각 재귀 호출하여 얻은 결과 중 더 큰 값을 반환합니다.

## 3. 사용 예제

스크립트의 `if __name__ == "__main__"` 블록은 사용 예제를 보여줍니다.

```python
if __name__ == "__main__":
    # 초기 배열 (전역 변수로 사용됨)
    A = [1, 2, -4, 7, 3, -5, 6, 11, -20, 9, 14, 15, 5, 2, -8]
    N = 15

    # 세그먼트 트리 생성
    segt = SegmentTree(A)

    # 구간 [4, 6]의 최댓값 쿼리 (1-based index)
    print(segt.query(4, 6))
    # 출력: 7

    # 구간 [7, 11]의 최댓값 쿼리
    print(segt.query(7, 11))
    # 출력: 14

    # 구간 [1, 3]의 값을 111로 업데이트
    segt.update(1, 3, 111)

    # 전체 구간 [1, 15]의 최댓값 쿼리
    print(segt.query(1, 15))
    # 출력: 111

    # 현재 배열 상태 출력
    segt.showData()
    # 출력: [111, 111, 111, 7, 3, -5, 235, 235, -20, 9, 14, 15, 5, 2, -8]
```