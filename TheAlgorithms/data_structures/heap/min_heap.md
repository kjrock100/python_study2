# `min_heap.py` 코드 설명

이 문서는 `min_heap.py` 스크립트에 구현된 최소 힙(Min-Heap) 자료 구조에 대해 설명합니다. 이 구현은 특히 **키 값 감소(decrease key)** 기능을 효율적으로 지원하는 데 중점을 둡니다.

## 1. 최소 힙(Min-Heap)이란?

힙은 완전 이진 트리(Complete Binary Tree)의 한 종류로, 특정 규칙을 만족하는 자료 구조입니다. 최소 힙은 다음과 같은 속성을 가집니다.

> **최소 힙 속성**: 모든 부모 노드의 값은 자신의 자식 노드의 값보다 작거나 같습니다.

이 속성으로 인해, 힙의 루트(root) 노드는 항상 힙 내에서 가장 작은 값을 가지게 됩니다. 이 구현은 리스트(list)를 사용하여 힙을 표현하며, 0-기반 인덱싱을 사용합니다.

## 2. 클래스 구조

### `Node` 클래스
-   **역할**: 힙에 저장될 각 원소를 표현합니다. 단순한 값이 아닌, 이름(`name`)과 값(`val`)을 함께 가지는 객체입니다.
-   `__lt__(self, other)`: 노드 간의 비교는 `val` 속성을 기준으로 이루어집니다.

### `MinHeap` 클래스
-   **역할**: 최소 힙의 모든 기능과 상태를 관리합니다.
-   **핵심 속성**:
    -   `heap`: 실제 `Node` 객체들이 저장되는 리스트.
    -   `idx_of_element`: 각 `Node` 객체를 키로, `heap` 리스트에서의 인덱스를 값으로 갖는 딕셔너리. 노드의 위치를 O(1)에 찾기 위해 사용됩니다.
    -   `heap_dict`: 노드의 `name`을 키로, `val`을 값으로 갖는 딕셔너리. 이름으로 값을 빠르게 조회하기 위해 사용됩니다.

## 3. 주요 메서드 설명

#### `__init__(self, array)`
-   **역할**: 주어진 `array`로부터 최소 힙을 생성합니다.
-   **동작**:
    1.  `idx_of_element`와 `heap_dict`를 초기화합니다.
    2.  `build_heap` 메서드를 호출하여 O(N) 시간에 힙을 구축합니다.

#### `build_heap(self, array)`
-   **역할**: 정렬되지 않은 리스트 `array`를 최소 힙으로 변환합니다.
-   **시간 복잡도**: O(N)
-   **동작**: 리프 노드가 아닌 마지막 노드부터 시작하여 루트까지 거슬러 올라가며 모든 노드에 대해 `sift_down`을 호출합니다.

#### `sift_down(self, idx, array)` (min-heapify)
-   **역할**: 특정 노드(`idx`)와 그 자식들 사이에서 최소 힙 속성이 위반되었을 경우, 이를 바로잡습니다.
-   **시간 복잡도**: O(log N)
-   **동작**: 현재 노드, 왼쪽 자식, 오른쪽 자식 중 가장 작은 값을 가진 노드를 찾아 부모 위치로 올립니다. 이 과정을 반복하여 서브트리 전체가 최소 힙 속성을 만족하도록 합니다.

#### `sift_up(self, idx)`
-   **역할**: `idx`번 인덱스의 원소를 부모 노드와 비교하여, 부모보다 작을 경우 위치를 바꾸는 과정을 반복합니다.
-   **시간 복잡도**: O(log N)

#### `insert(self, node)`
-   **역할**: 힙에 새로운 `node`를 삽입합니다.
-   **시간 복잡도**: O(log N)
-   **동작**: 노드를 리스트의 맨 끝에 추가한 후, `sift_up`을 호출하여 힙 속성을 복원합니다.

#### `remove(self)`
-   **역할**: 힙에서 최솟값(루트)을 제거하고 반환합니다.
-   **시간 복잡도**: O(log N)
-   **동작**:
    1.  루트 노드를 힙의 마지막 원소와 교체합니다.
    2.  마지막 원소를 제거하고, 관련 딕셔너리에서도 삭제합니다.
    3.  새로운 루트에서 `sift_down`을 호출하여 힙 속성을 복원합니다.

#### `decrease_key(self, node, newValue)`
-   **역할**: 특정 `node`의 값을 더 작은 `newValue`로 갱신합니다. 다익스트라(Dijkstra)나 프림(Prim) 알고리즘 등에서 유용하게 사용됩니다.
-   **시간 복잡도**: O(log N)
-   **동작**:
    1.  `idx_of_element` 딕셔너리를 통해 해당 노드의 위치를 O(1)에 찾습니다.
    2.  노드의 값을 `newValue`로 변경합니다.
    3.  `sift_up`을 호출하여 변경된 노드를 올바른 위치로 이동시킵니다.

## 4. 사용 예제

스크립트 하단에는 이 `MinHeap` 클래스의 사용법을 보여주는 예제 코드가 포함되어 있습니다.

```python
# 여러 노드 객체 생성
r = Node("R", -1)
b = Node("B", 6)
a = Node("A", 3)
x = Node("X", 1)
e = Node("E", 4)

# 노드 리스트로부터 최소 힙 생성
myMinHeap = MinHeap([r, b, a, x, e])

# 초기 힙 상태 출력
# Min Heap - before decrease key
# Node(R, -1)
# Node(X, 1)
# Node(A, 3)
# Node(B, 6)
# Node(E, 4)

# 'B' 노드의 키 값을 -17로 감소
myMinHeap.decrease_key(b, -17)

# 변경 후 힙 상태 출력 (b가 새로운 루트가 됨)
# Min Heap - After decrease key of node [B -> -17]
# Node(B, -17)
# Node(X, 1)
# Node(R, -1)
# Node(A, 3)
# Node(E, 4)
```

## 5. 테스트

스크립트에는 `doctest`가 포함되어 있어 코드의 정확성을 검증할 수 있습니다. 터미널에서 다음 명령어를 실행하여 테스트를 진행할 수 있습니다.

```bash
python -m doctest /home/kjrock/work2/study/kjrock100/python_study2/TheAlgorithms/data_structures/heap/min_heap.py
```