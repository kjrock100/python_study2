# `heap.py` 코드 설명

이 문서는 `heap.py` 스크립트에 구현된 최대 힙(Max-Heap) 자료 구조에 대해 설명합니다.

## 1. 최대 힙(Max-Heap)이란?

힙은 완전 이진 트리(Complete Binary Tree)의 한 종류로, 특정 규칙을 만족하는 자료 구조입니다. 최대 힙은 다음과 같은 속성을 가집니다.

> **최대 힙 속성**: 모든 노드의 값은 자신의 자식 노드의 값보다 크거나 같습니다.

이 속성으로 인해, 힙의 루트(root) 노드는 항상 힙 내에서 가장 큰 값을 가지게 됩니다. 이 구현은 리스트(list)를 사용하여 힙을 표현합니다.

## 2. 클래스 및 메서드 설명

### `Heap` 클래스

#### `__init__(self)`
-   **역할**: 힙을 초기화합니다.
-   **속성**:
    -   `h`: 실제 힙 원소들이 저장되는 리스트.
    -   `heap_size`: 힙에 포함된 원소의 개수.

#### `parent_index(i)`, `left_child_idx(i)`, `right_child_idx(i)`
-   **역할**: 리스트 기반 힙에서 특정 인덱스 `i`의 부모 및 자식 노드 인덱스를 계산합니다.

#### `max_heapify(self, index: int)`
-   **역할**: 특정 노드(`index`)와 그 자식들 사이에서 최대 힙 속성이 위반되었을 경우, 이를 바로잡습니다.
-   **시간 복잡도**: O(log N)
-   **동작**: 현재 노드, 왼쪽 자식, 오른쪽 자식 중 가장 큰 값을 가진 노드를 찾아 부모 위치로 올립니다. 이 과정을 재귀적으로 반복하여 서브트리 전체가 최대 힙 속성을 만족하도록 합니다.

#### `build_max_heap(self, collection: Iterable[float])`
-   **역할**: 정렬되지 않은 리스트 `collection`을 최대 힙으로 변환합니다.
-   **시간 복잡도**: O(N)
-   **동작**: 리프 노드가 아닌 마지막 노드부터 시작하여 루트까지 거슬러 올라가며 모든 노드에 대해 `max_heapify`를 호출합니다.

#### `max(self)`
-   **역할**: 힙에서 최댓값을 삭제하지 않고 반환합니다. (루트 노드의 값)

#### `extract_max(self)`
-   **역할**: 힙에서 최댓값을 제거하고 반환합니다.
-   **시간 복잡도**: O(log N)
-   **동작**:
    1.  루트 노드(최댓값)를 저장합니다.
    2.  힙의 마지막 원소를 루트 위치로 가져옵니다.
    3.  힙 크기를 1 줄입니다.
    4.  루트에서 `max_heapify`를 호출하여 힙 속성을 복원합니다.

#### `insert(self, value: float)`
-   **역할**: 힙에 새로운 값을 삽입합니다.
-   **시간 복잡도**: O(N). 이 구현은 삽입 후 루트부터 `max_heapify`를 반복하므로 비효율적입니다. 일반적인 힙 삽입은 O(log N)입니다.
    > **개선 제안**: 일반적인 힙 삽입 방식은 값을 맨 끝에 추가한 후, 부모와 비교하며 위로 올라가는(`heapify-up`) 방식(O(log N))을 사용합니다. 현재 구현은 삽입 후 전체 트리의 상위 절반에 대해 `max_heapify`를 다시 수행하여 비효율적입니다.

#### `heap_sort(self)`
-   **역할**: 힙을 사용하여 리스트를 오름차순으로 정렬합니다. (힙 정렬)
-   **시간 복잡도**: O(N log N)
-   **동작**:
    1.  힙의 루트(최댓값)와 마지막 원소를 교환합니다.
    2.  힙의 크기를 1 줄여서 정렬된 마지막 원소를 제외시킵니다.
    3.  루트에서 `max_heapify`를 호출하여 힙 속성을 복원합니다.
    4.  힙에 원소가 하나 남을 때까지 이 과정을 반복합니다.

## 3. 사용 예제

`doctest`와 `if __name__ == "__main__"` 블록에 다양한 사용 예제가 포함되어 있습니다.

```python
unsorted = [103, 9, 1, 7, 11, 15, 25, 201, 209, 107, 5]

# 힙 생성 및 빌드
h = Heap()
h.build_max_heap(unsorted)
print(h)
# 출력: [209, 201, 25, 103, 107, 15, 1, 9, 7, 11, 5]

# 최댓값 추출
max_val = h.extract_max()
print(max_val)
# 출력: 209

# 새로운 값 삽입
h.insert(100)
print(h)
# 출력: [201, 107, 25, 103, 100, 15, 1, 9, 7, 5, 11]

# 힙 정렬
h.heap_sort()
print(h)
# 출력: [1, 5, 7, 9, 11, 15, 25, 100, 103, 107, 201]
```

## 4. 테스트

스크립트에는 `doctest`가 포함되어 있어 코드의 정확성을 검증할 수 있습니다. 터미널에서 다음 명령어를 실행하여 테스트를 진행할 수 있습니다.

```bash
python -m doctest /home/kjrock/work2/study/kjrock100/python_study2/TheAlgorithms/data_structures/heap/heap.py
```